<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="refresh" content="60"/>
    <!--<meta name="viewport" content="width=device-width, initial-scale=1"/>-->
    <link rel="stylesheet" href="../../static/css/bootstrap.min.css" th:href="@{../../static/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="../../static/css/bootstrap-theme.min.css"
          th:href="@{../../static/css/bootstrap-theme.min.css}"/>
    <link rel="stylesheet" href="../../static/css/tickets.css" th:href="@{../../static/css/tickets.css}"/>
    <title>会员统计</title>
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html" th:href="@{index}">Tickets</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="index.html" th:href="@{index}">Tickets</a></li>
                <li class="active"><a href="statistics.html" th:href="@{statistics}">Statistics</a></li>
                <li><a href="profile.html" th:href="@{profile}">Profile</a></li>
                <li><a href="coupon.html" th:href="@{coupon}">Coupon</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Welcome<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="../account/index.html" th:href="@{../logout}">Sign out</a></li>
                        <li><a href="../account/register.html" th:href="@{../register}">Register</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<div class="mainpage">
    <div class="panel panel-info">
        <div class="panel-heading" role="tab" id="headingOne">
            <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                   aria-expanded="true" aria-controls="collapseOne">
                    预订订单
                </a>
            </h4>
        </div>
        <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
            <div class="panel-body">
                <div class="table-responsive " style="overflow-x: auto; overflow-y: auto; height: 200px; width:1439px;">
                    <table class="table table-hover">
                        <tr>
                            <th>订单号</th>
                            <th>场馆名</th>
                            <th>活动类型</th>
                            <th>活动日期</th>
                            <th>前排座数</th>
                            <th>前排座价</th>
                            <th>后排座数</th>
                            <th>后排座价</th>
                            <th>总价</th>
                            <th>是否付款</th>
                            <th>付款操作</th>
                            <th>退订操作</th>
                        </tr>
                        <tr th:each="bookOrders : ${statistics.bookOrderVOS}">
                            <!--<td th:text="(${venue.approve == 0}) ? '未批准注册申请' : ((${venue.approve == 1})?'未批准信息修改':'已批准信息修改')">-->

                            <td class="cid" th:text="${bookOrders.cid}"></td>
                            <td th:text="${bookOrders.venueName}"></td>
                            <td th:text="${bookOrders.type}"></td>
                            <td th:text="${#dates.format(new java.util.Date(bookOrders.date),'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${bookOrders.fsnumber}"></td>
                            <td th:text="${bookOrders.fprice}"></td>
                            <td th:text="${bookOrders.bsnumber}"></td>
                            <td th:text="${bookOrders.bprice}"></td>
                            <td class="ap" th:text="${bookOrders.aprice}"></td>
                            <td th:text="(${bookOrders.isbought == 1})?'已付款':'未付款'"></td>
                            <td>

                                <button class="buy">付款</button>
                            </td>
                            <td>
                                <button class="us">退订</button>
                            </td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-info">
        <div class="panel-heading" role="tab" id="headingTwo">
            <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo"
                   aria-expanded="true" aria-controls="collapseTwo">
                    退订订单
                </a>
            </h4>
        </div>
        <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingTwo">
            <div class="panel-body">
                <div class="table-responsive " style="overflow-x: auto; overflow-y: auto; height: 200px; width:1439px;">
                    <table class="table table-hover">
                        <tr>
                            <th>订单号</th>
                            <th>场馆名</th>
                            <th>活动类型</th>
                            <th>活动日期</th>
                            <th>前排座数</th>
                            <th>前排座价</th>
                            <th>后排座数</th>
                            <th>后排座价</th>
                            <th>总价</th>
                        </tr>
                        <tr th:each="unsubscribeOrders : ${statistics.unsubscribeOrderVOS}">
                            <td th:text="${unsubscribeOrders.cid}"></td>
                            <td th:text="${unsubscribeOrders.venueName}"></td>
                            <td th:text="${unsubscribeOrders.type}"></td>
                            <td th:text="${#dates.format(new java.util.Date(unsubscribeOrders.date),'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${unsubscribeOrders.fsnumber}"></td>
                            <td th:text="${unsubscribeOrders.fprice}"></td>
                            <td th:text="${unsubscribeOrders.bsnumber}"></td>
                            <td th:text="${unsubscribeOrders.bprice}"></td>
                            <td th:text="${unsubscribeOrders.aprice}"></td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="panel panel-info">
        <div class="panel-heading" role="tab" id="headingThree">
            <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree"
                   aria-expanded="true" aria-controls="collapseThree">
                    完成订单
                </a>
            </h4>
        </div>
        <div id="collapseThree" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingThree">
            <div class="panel-body">
                <div class="table-responsive " style="overflow-x: auto; overflow-y: auto; height: 200px; width:1439px;">
                    <table class="table table-hover">
                        <tr>
                            <th>订单号</th>
                            <th>场馆名</th>
                            <th>活动类型</th>
                            <th>活动日期</th>
                            <th>前排座数</th>
                            <th>前排座价</th>
                            <th>后排座数</th>
                            <th>后排座价</th>
                            <th>总价</th>
                        </tr>
                        <tr th:each="completeOrders : ${statistics.completeOrderVOS}">
                            <td th:text="${completeOrders.cid}"></td>
                            <td th:text="${completeOrders.venueName}"></td>
                            <td th:text="${completeOrders.type}"></td>
                            <td th:text="${#dates.format(new java.util.Date(completeOrders.date),'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${completeOrders.fsnumber}"></td>
                            <td th:text="${completeOrders.fprice}"></td>
                            <td th:text="${completeOrders.bsnumber}"></td>
                            <td th:text="${completeOrders.bprice}"></td>
                            <td th:text="${completeOrders.aprice}"></td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
    </div>

    <nav aria-label="Page navigation" class="col-md-offset-10 col-md-4">
        <ul class="pagination pagination-sm">
            <li>
                <a href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li>
                <a href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>


<script src="../../static/js/jquery-3.1.1.min.js" th:src="@{../../static/js/jquery-3.1.1.min.js}"></script>
<script src="../../static/js/bootstrap.min.js" th:src="@{../../static/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:inline="javascript">


    $('.buy').on('click',function () {
       alert("按下按钮");
       var cid = $(this).parents("tr").find(".cid").text();
       var ap = $(this).parents("tr").find(".ap").text();
        var inputs = {cid: cid, ap: ap, isbought: 1};
        alert(JSON.stringify(inputs));
        $.ajax({
            type: "POST",
            url: "/member/buy",
            data: inputs,
            dataType: "json",
            success: function (data) {
                alert(data.number);
                if (data.number == 1) {
                    alert("付款成功");
                    location.reload();
                } else if(data.number == 2){
                    alert("您的余额不足，无法付款");
                    location.reload();
                } else if(data.number == 0){
                    alert("此订单无需再付款");
                    location.reload();
                }
            }
        });
    });

    $('.us').on('click',function () {
        alert("按下退订");
        var cid = $(this).parents("tr").find(".cid").text();
        var inputs = {cid:cid,isus: 1};
        $.ajax({
            type: "POST",
            url: "/member/us",
            data: inputs,
            dataType: "json",
            success: function (data) {
                alert("退订成功");
                location.reload();
            }
        });
    });


</script>


</body>
</html>